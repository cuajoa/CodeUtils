CREATE TABLE #CONDOMINIOS
(
	ID					numeric(10) IDENTITY(1,1) NOT NULL,
	CodPersona			numeric (10) NULL,
	CodCuotapartista	numeric (10) NULL,
	CodInterfazPer		varchar(30) NULL,
	CodInterfazCpt		varchar(30) NULL,
	Orden				numeric(10) NULL,
	FechaInterfEntr		smalldatetime NULL,
	PorcParticip		numeric(22,9) NULL
)


INSERT INTO #CONDOMINIOS(CodInterfazCpt, CodInterfazPer, Orden, FechaInterfEntr, PorcParticip)
	SELECT VFondos.dbo.CUOTAPARTISTAS.CodInterfaz, VFondos.dbo.PERSONAS.CodInterfaz, CONDOMINIOS.Orden, CONDOMINIOS.FechaInterfEntr, CONDOMINIOS.PorcParticip
	FROM VFondos.dbo.CUOTAPARTISTAS
	INNER JOIN VFondos.dbo.CONDOMINIOS ON CUOTAPARTISTAS.CodCuotapartista = CONDOMINIOS.CodCuotapartista
	INNER JOIN VFondos.dbo.PERSONAS ON CONDOMINIOS.CodPersona = PERSONAS.CodPersona
	WHERE  PERSONAS.CodInterfaz IS NOT NULL AND CUOTAPARTISTAS.CodInterfaz IN (
		SELECT CodInterfaz FROM VFondos_2QA.dbo.CUOTAPARTISTAS
		WHERE NumCuotapartista IN (1002535,1002546,1002549,1002550,1002567,1002568,1002569,1002570,1002571,1002572,1002574,1002575,1002576,1002577,1002578,1002579,1002581,
		1002582,1002584,1002586,1002587,1002588,1002589,1002590,1002591,1002592,1002593,1002594,1002595,1002596,1002598,1002601,1002606,1002609,
		1002611,1002612,1002613,1002616,1002617,1002618,1002619,1002623,1002624,1002625,1002627,1002628,1002629,1002635,1002636,1002637,1002638,
		1002639,1002640,1002641,1002642,1002643,1002644,1002645,1002646,1002647,1002648,1002649,1002650,1002651,1002655,1002656,1002658,1002659,
		1002661,1002663,1002664,1002665,1002666,1002667,1002669,1002670,1002672,1002673,1002674,1002677,1002679,1002680,1002681,1002682,1002684,
		1002686,1002687,1002688,1002689,1002690,1002691,1002696,1002697,1002698,1002700,1002701,1002702,1002703,1002704,1002705,1002708,1002711,
		1002712,1002713,1002714,1002715,1002716,1002718,1002720,1002721,1002724,1002725,1002726,1002730,1002733,1002734,1002735,1002736,1002737,
		1002740,1002741,1002742,1002745,1002746,1002747,1002748,1002749,1002750,1002751,1002752,1002753)
	)

UPDATE #CONDOMINIOS
SET
CodPersona = PERSONAS.CodPersona
FROM VFondos_2QA.dbo.PERSONAS
INNER JOIN #CONDOMINIOS ON #CONDOMINIOS.CodInterfazPer COLLATE database_default = PERSONAS.CodInterfaz COLLATE database_default


UPDATE #CONDOMINIOS
SET
CodCuotapartista = CUOTAPARTISTAS.CodCuotapartista
FROM VFondos_2QA.dbo.CUOTAPARTISTAS
INNER JOIN #CONDOMINIOS ON #CONDOMINIOS.CodInterfazCpt COLLATE database_default = CUOTAPARTISTAS.CodInterfaz COLLATE database_default


SELECT * FROM #CONDOMINIOS

DECLARE @CodAuditoriaRef numeric(10)

INSERT AUDITORIASREF (NomEntidad)
VALUES ('CONDOMINIOS')
SELECT @CodAuditoriaRef = @@IDENTITY


INSERT INTO VFondos_2QA.dbo.CONDOMINIOS (CodCuotapartista,CodPersona,Orden,FechaInterfEntr,EstaAnulado,CodAuditoriaRef,PorcParticip)
SELECT CodCuotapartista, CodPersona, Orden, FechaInterfEntr, 0, @CodAuditoriaRef, PorcParticip
FROM #CONDOMINIOS
WHERE CodPersona NOT IN (65622, 65738)

DROP TABLE #CONDOMINIOS

